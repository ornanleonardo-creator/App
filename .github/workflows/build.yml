name: Build Android APK

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    # Ã‰tape 1: TÃ©lÃ©charger le code
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    # Ã‰tape 2: Installer Node.js
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    # Ã‰tape 3: Installer Java (nÃ©cessaire pour Android)
    - name: â˜• Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
        
    # Ã‰tape 4: Installer Capacitor
    - name: ğŸ“¦ Install Capacitor
      run: |
        npm install -g @capacitor/cli @capacitor/core
        
    # Ã‰tape 5: Initialiser le projet Android
    - name: ğŸ¤– Setup Android Project
      run: |
        npx cap init --web-dir . --app-id com.monapp.android --app-name "Mon App" --npm-client npm
        npx cap add android
        
    # Ã‰tape 6: Build APK
    - name: ğŸ—ï¸ Build Android APK
      run: |
        cd android
        chmod +x gradlew
        ./gradlew assembleDebug --no-daemon
        
    # Ã‰tape 7: Upload APK (VERSION CORRIGÃ‰E)
    - name: ğŸ“¤ Upload APK File
      uses: actions/upload-artifact@v4
      with:
        name: app-android-debug
        path: android/app/build/outputs/apk/debug/
        
    # Ã‰tape 8: Message de succÃ¨s
    - name: âœ… Build Successful
      run: echo "ğŸ‰ APK crÃ©Ã© avec succÃ¨s! TÃ©lÃ©charge-le dans l'onglet Artifacts."
